var admin={};admin.callback="",admin.hash="",admin.layout_slug="",admin.xhr2json=function(xhr){return xhr.responseText[0]=="{"&&xhr.responseText[xhr.responseText.length-1]=="}"||xhr.responseText[0]=="["&&xhr.responseText[xhr.responseText.length-1]=="]"?eval("("+xhr.responseText+")"):{msg:xhr.responseText}},status_code_decorator=function(a){return function(b){a(b),admin.loading.hide()}},STATUS_CODE={200:function(a){admin.panels.display("center",a.html),a.msg!=undefined&&admin.messages.alert(a.msg)},202:function(a){console.log("redirection asked :",a.location),window.location.href=a.location},400:function(a){json=admin.xhr2json(a),admin.panels.display("center",json.html),json.msg!=undefined&&admin.messages.alert(json.msg)},403:function(a){json=admin.xhr2json(a),admin.messages.alert(gettext("You don't have the right to modify this settings."))},404:function(a){json=admin.xhr2json(a),json.msg!=undefined?admin.messages.error(json.msg):admin.messages.error(gettext("Element not found."))},409:function(a){json=admin.xhr2json(a),json.msg!=undefined&&admin.messages.error(json.msg,800)},500:function(a){json=admin.xhr2json(a),json.msg!=undefined&&admin.messages.error(json.msg)}},admin.urljoin=function(a,b){if(a!=undefined&&b!=undefined){s_url=a.split("/"),s_suffix=b.split("/");var c=Array("");for(k in s_url)s_url[k]&&c.push(s_url[k]);for(k in s_suffix)s_suffix[k]&&c.push(s_suffix[k]);c.push("");return c.join("/")}return a},admin.ajax=function(a){window.location.pathname!="/"&&(a.url=admin.urljoin(window.location.pathname,a.url));if(a.statusCode!=undefined)for(key in STATUS_CODE)a.statusCode[key]==undefined&&(a.statusCode[key]=STATUS_CODE[key]);else a.statusCode=STATUS_CODE;for(key in a.statusCode)a.statusCode[key]=status_code_decorator(a.statusCode[key]);a.error=function(a,b,c){b=="error"&&c==""&&admin.messages.error("Le serveur ne r√©pond pas")},admin.loading.show(function(){$.ajax(a)})},admin.GET=function(a){a.type="GET",admin.ajax(a)},admin.POST=function(a){a.type="POST",admin.ajax(a)},admin.PUT=function(a){a.type="PUT",admin.ajax(a)},admin.DELETE=function(a){a.type="DELETE",admin.ajax(a)},admin.serialize=function(a){typeof tinyMCE!="undefined"&&(tinyMCE.triggerSave(),tinyMCE=undefined),console.log($(a).serialize());return $(a).serialize()},admin.login={show:function(){$("#ionyweb_admin_login").show("drop",{},250),$(document).keyup(function(a){a.keyCode==27&&admin.login.hide()})},connect:function(){list=admin.serialize("#ionyweb_admin_login form"),admin.POST({url:"/wa/login/",data:list,statusCode:{200:function(a){$("#ionyweb_admin_login").hide("drop",{direction:"right"},250,function(){window.location.hash="",window.location.reload()})},400:function(a){json=admin.xhr2json(a),$("#ionyweb_admin_login_error").html(json.msg)}}})},hide:function(){window.location.hash="",$("#ionyweb_admin_login").hide("drop",{direction:"right"},250)}},admin.cancel_form=function(){admin.panels.close_all(),admin.urls.hash("")},admin.logout=function(){admin.GET({url:"/wa/logout/",statusCode:{200:function(a){admin.edit.deactive(),$("#ionyweb_admin").hide("slide",function(){window.location.hash="#",window.location.reload()})}}})},admin.loading={show:function(a){a&&a(),$("#wa_panel_loading").show("fade")},hide:function(a){a&&a(),$("#wa_panel_loading").stop().hide("fade")}},admin.apps={edit:function(a){url="/wa/page_app/",a!=undefined&&(url+=a+"/"),admin.GET({url:url})},save:function(a){url="/wa/page_app/",a!=undefined&&(url+=a+"/"),list=admin.serialize("#app_form_form"),admin.POST({url:url,data:list,statusCode:{200:function(a){admin.messages.alert(a.msg),admin.panels.close_all(),a.layout_section_slug&&a.html&&(admin.pages.refresh_layout(a.layout_section_slug,a.html),admin.edit.refresh()),!a.refresh_pages_list}}})}},admin.design={styles:function(a){a===undefined?ajax_url="/wa/design/":ajax_url="/wa/design/"+a+"/",admin.GET({url:ajax_url,statusCode:{200:function(a){admin.urls.hash("/themes/styles/!/"+a.current),admin.panels.display("bottom_large",a.html)}}})},list:function(){admin.GET({url:"/wa/designs/",statusCode:{200:function(a){admin.urls.hash("/themes"),admin.panels.display("bottom_large",a.html)}}})},preview:function(a){},change:function(a,b){admin.POST({url:"/wa/design/list/",data:{theme_slug:a,csrfmiddlewaretoken:b},statusCode:{200:function(a){window.location.reload()}}})},custom:function(){}},admin.edit={is_active:!1,header:!1,content:!1,footer:!1,active:function(){this.is_active?this.deactive():(admin.urls.hash("/content"),admin.panels.close_all(),admin.menu.close_sub_menu(),admin.messages.refresh_help_text_bubble(),this.is_active=!0,this.edit_content())},deactive:function(){this.is_active&&(admin.panels.close_all(),$(".wa_placeholder_structure").hide("fast"),this.content&&this.edit_content(),this.header&&this.edit_header(),this.footer&&this.edit_footer(),this.is_active=!1,admin.urls.hash(""))},edit_content:function(){this.is_active&&(this.header&&this.edit_header(),this.footer&&this.edit_footer(),this.content?($(".placeholder").sortable("disable"),$(".placeholder").enableSelection(),$(".placeholder").removeClass("wa_placeholder"),$("#placeholder-default").hide("fast"),$("#default-placeholder").hide("fast"),$("#clipboard-placeholder").hide("fast"),this.content=!1,this.clipboard.deactive(),$(".widget .wa_plugin_widget").hide("fast"),$(".wa_actions_object_widget").hide("fast")):($(".placeholder").addClass("wa_placeholder"),$("#default-placeholder").show("fast"),$("#clipboard-placeholder").show("fast"),$(".wa_placeholder_structure").show("fast"),$(".placeholder .wa_placeholder_widget").show("fast"),this.clipboard.active(),$(".widget .wa_plugin_widget").show("fast"),$(".wa_actions_object_widget").show("fast"),$(".placeholder").sortable({items:".placeholder-container",handle:".sortable_click",connectWith:".placeholder",tolerance:"pointer",opacity:.6,forcePlaceholderSize:!0,placeholder:"ui-state-highlight",start:function(a,b){b.item.find("[rel=tooltip]").tooltip("hide")},stop:function(a,b){var c=!1,d=gettext("You can't move this item in this placeholder.");item_id=b.item.attr("id"),placeholder_id=b.item.parent(".placeholder").attr("id"),placeholder_id=="default-placeholder"&&(c=!0,console.log(gettext("Items can not be moved in the default placeholder !"))),item_id.split("-")[0]=="app"&&placeholder_id=="clipboard-placeholder"&&(c=!0,d=gettext("The App Page can not be moved in the clipboard !")),c?(console.log("Illegal Move !!"),$(this).sortable("cancel"),admin.messages.error(d)):admin.POST({url:"/wa/plugin-page-relation/",data:{placeholder_id:placeholder_id,plugins_order:b.item.parent(".placeholder").sortable("toArray")},statusCode:{200:function(a){admin.messages.alert(a.msg,400)},400:function(a){admin.messages.error(a.msg,800)}}})}}),$(".placeholder").sortable("enable"),$(".placeholder").disableSelection(),this.content=!0))},edit_header:function(){this.is_active&&(this.header?($(".placeholder-header").sortable("destroy"),$(".placeholder-header").enableSelection(),$(".placeholder-header").removeClass("wa_placeholder"),$(".placeholder-header .wa_placeholder_widget").hide("fast"),this.header=!1):(this.content&&this.edit_content(),this.footer&&this.edit_footer(),$(".placeholder-header .wa_placeholder_widget").show("fast"),$(".placeholder-header").addClass("wa_placeholder"),$(".placeholder-header").sortable({items:".placeholder-container",handle:".sortable_click",connectWith:".placeholder-header",tolerance:"pointer",opacity:.6,forcePlaceholderSize:!0,placeholder:"ui-state-highlight",start:function(a,b){b.item.find("[rel=tooltip]").tooltip("hide")},stop:function(a,b){admin.POST({url:"/wa/plugin-page-relation/",data:{placeholder:b.item.parent(".placeholder-header").attr("id"),placeholder_order:b.item.parent(".placeholder-header").sortable("toArray")},statusCode:{200:function(a){admin.messages.alert(a.msg,400)},400:function(a){admin.messages.error(a.msg,800)}}})}}),$(".placeholder-header").disableSelection(),this.header=!0))},edit_footer:function(){this.is_active&&(this.footer?($(".placeholder-footer").sortable("destroy"),$(".placeholder-footer").enableSelection(),$(".placeholder-footer").removeClass("wa_placeholder"),$(".placeholder-footer .wa_placeholder_widget").hide("fast"),this.footer=!1):(this.content&&this.edit_content(),this.header&&this.edit_header(),$(".placeholder-footer .wa_placeholder_widget").show("fast"),$(".placeholder-footer").addClass("wa_placeholder"),$(".placeholder-footer").sortable({items:".placeholder-container",handle:".sortable_click",connectWith:".placeholder-footer",tolerance:"pointer",opacity:.6,forcePlaceholderSize:!0,placeholder:"ui-state-highlight",start:function(a,b){b.item.find("[rel=tooltip]").tooltip("hide")},stop:function(a,b){}}),$(".placeholder-footer").disableSelection(),this.footer=!0))},refresh:function(){this.is_active&&(this.footer=!1,this.header=!1,this.content=!1,this.edit_content())},settings:function(){admin.messages.error("Modifier les settings de l'admin"),admin.menu.edit_hide()},clipboard:{active:function(){$("#clipboard-placeholder .wa_placeholder_widget").click(function(){$("#clipboard-placeholder").css("left")=="0px"?$("#clipboard-placeholder").animate({left:"-250px"},100):$("#clipboard-placeholder").animate({left:"0px"},100)})},deactive:function(){$("#clipboard-placeholder .wa_placeholder_widget").unbind("click")}}},admin.layouts={list:function(a){if(!a)return!1;admin.GET({url:"/wa/layouts/",data:{layout_section_slug:a},statusCode:{200:function(a){admin.panels.display("bottom",a.html)}}})},preview:function(a,b,c){if(a&&b&&c){var d=[],e=[];$("#default-placeholder .placeholder-container").each(function(){var a=$(this);d.push(a.attr("id")),e.push(a.attr("data-placeholder-slug"))}),admin.GET({url:"/wa/layout/",data:{layout_template_slug:a,layout_section_slug:b,plugin_relation_default:d,plugin_relation_default_placeholder:e},statusCode:{200:function(d){admin.pages.refresh_layout_and_default_with_html(d.layout_section_slug,d.html,d.default_to_add,d.default_to_delete),admin.edit.refresh(),admin.messages.confirm(gettext("Do you want save this layout ?"),function(){admin.layouts.edit(a,b,c)},function(){admin.pages.refresh_layout(b),admin.edit.refresh()})}}})}},edit:function(a,b,c){a&&b&&c&&admin.POST({url:"/wa/layout/",data:{layout_template_slug:a,layout_section_slug:b},statusCode:{200:function(a){admin.messages.alert(a.msg),admin.panels.close("bottom")}}})}},admin.menu={see:function(){admin.urls.hash(""),admin.pages.active=!1,admin.edit.deactive(),admin.menu.close_sub_menu(),admin.panels.close_all()},close_sub_menu:function(){$("#wa_toolbar_menu .sub_menu .content").hide("fade"),$("#wa_toolbar_menu .sub_menu").removeClass("open")}},$(document).ready(function(){$("#wa_toolbar_menu li a").click(function(){var a=$(this);if($(this).parents(".sub_menu").length==1)a=$(this).parents(".sub_menu"),admin.edit.deactive(),a.hasClass("open")?(a.removeClass("open"),a.children(".content").hide("fade",{duration:200})):($(".sub_menu").removeClass("open"),$(".sub_menu").children(".content").hide("fade",{duration:200}),a.children(".content").show("fade",{duration:200}),a.addClass("open")),$(this).parents(".content").length==1?($("#wa_toolbar_menu li").removeClass("selected"),a.addClass("selected"),a.children(".content").hide("fade")):a.hasClass("selected")?($("#wa_toolbar_menu li").removeClass("selected"),$("#wa_toolbar_menu li.preview").addClass("selected")):($("#wa_toolbar_menu li").removeClass("selected"),a.addClass("selected"));else{a=a.parent();if(!a.hasClass("sub_menu")||!a.hasClass("selected"))a.hasClass("selected")?($("#wa_toolbar_menu li").removeClass("selected"),$("#wa_toolbar_menu li.preview").addClass("selected")):($("#wa_toolbar_menu li").removeClass("selected"),a.addClass("selected"))}})}),admin.messages={alert:function(a,b){b===undefined&&(b="2000"),$("#admin_message").append("<div class='message'><p>"+a+"</p></div>"),$("#admin_message .message:last").show("drop").delay(b).hide("drop",function(){$("#admin_message .message:hidden").remove()})},confirm:function(a,b,c){$.confirm({message:a,buttons:{Yes:{"class":"blue",action:function(){b()},verbose_name:gettext("Yes")},No:{"class":"gray",action:function(){c&&c()},verbose_name:gettext("No")}}})},error:function(a,b){b===undefined&&(b="2000"),$("#admin_message").append("<div class='error'><p>"+a+"</p></div>"),$("#admin_message .error:last").show("drop").delay(b).hide("drop",function(){$("#admin_message .error:hidden").remove()})},draft:function(a,b){b===undefined&&(b="2000"),$("#admin_message").append("<div class='draft'><p>"+a+"</p></div>"),$("#admin_message .draft:last").show("drop").delay(b).hide("drop",function(){$("#admin_message .draft:hidden").remove()})},refresh_help_text_bubble:function(){$("[rel=tooltip]").tooltip()}},admin.pages={active:!1,active_sortable:function(){$("ol.move_liste_pages").nestedSortable({disableNesting:"no-nest",forcePlaceholderSize:!0,handle:".move_grip",helper:"clone",items:"li",opacity:.6,placeholder:"sortable_placeholder",errorClass:"sortable_placeholder_error",revert:250,scroll:!0,scrollSensitivity:40,scrollSpeed:40,tabSize:25,tolerance:"pointer",toleranceElement:"> div",stop:function(a,b){var c=$(b.item).attr("id"),d=$("#"+c),e=d.parents("li").attr("id"),f=d.prev().attr("id"),g=d.next().attr("id");admin.POST({url:"/wa/page/"+c+"/",data:{move:"move",parent:e,previous:f,next:g},statusCode:{200:function(a){a.msg&&admin.messages.alert(a.msg),a.navigation_html&&admin.pages.refresh_navigation(a.navigation_html),a.manager_html&&admin.panels.change_content("full",a.manager_html),admin.pages.active_sortable()},203:function(a){admin.messages.error(a.msg)}}})}})},list:function(){this.active==!0?(admin.panels.close("full"),this.active=!1):(admin.edit.deactive(),admin.loading.show(function(){admin.GET({url:"/wa/pages/",statusCode:{200:function(a){admin.loading.hide(),admin.panels.display("full",a.html),admin.pages.active=!0,admin.pages.active_sortable(),$("#wa_toolbar_menu li").removeClass("selected"),$("#wa_toolbar_menu li.page_manager").addClass("selected")}}})}))},add:function(){admin.PUT({url:"/wa/page/",statusCode:{200:function(a){this.active=!1,admin.panels.display("center",a.html)}}})},create_form:function(a){a==undefined&&(a=0),admin.GET({url:"/wa/page/",data:{parent:a},statusCode:{200:function(a){this.active=!1,admin.panels.display("center",a.html)}}})},create:function(){list=admin.serialize("#page_form_form"),admin.PUT({url:"/wa/page/",data:list})},edit_form:function(a){admin.GET({url:"/wa/page/"+a+"/",statusCode:{200:function(a){this.active=!1,admin.panels.display("center",a.html)},203:function(a){admin.messages.error(a.msg),admin.panels.change_content("center",a.html)}}})},edit:function(a){list=admin.serialize("#page_form_form"),admin.POST({url:"/wa/page/"+a+"/",data:list,statusCode:{200:function(a){a.msg&&admin.messages.alert(a.msg),a.navigation_html&&admin.pages.refresh_navigation(a.navigation_html),a.page_html&&admin.pages.refresh_content(a.page_html),admin.panels.close_all()},203:function(a){admin.messages.error(a.msg),admin.panels.change_content("center",a.html)}}})},remove:function(a){admin.messages.confirm(gettext("Deleting the page :<br /><br />Be careful : the app and all plugins will be deleted.<br/><br />Are you sure you want to delete this page now?<br /><br />"),function(){admin.DELETE({url:"/wa/page/"+a+"/",statusCode:{200:function(a){a.msg&&admin.messages.alert(a.msg),a.navigation_html&&admin.pages.refresh_navigation(a.navigation_html),$("#"+a.id).hide("slow",function(){$("#"+a.id).remove()})},203:function(a){admin.messages.error(a.msg),admin.pages.list()}}})})},toggle_draft:function(a){admin.POST({url:"/wa/page/"+a+"/",data:{draft:""},statusCode:{200:function(a){admin.panels.change_content("full",a.html),a.navigation_html&&(admin.pages.refresh_navigation(a.navigation_html),admin.pages.refresh_content())},203:function(a){admin.messages.error(a.msg)}}})},duplicate:function(a){admin.GET({url:"/wa/page/duplicate/"+a+"/",statusCode:{200:function(a){admin.panels.change_content("full",a.html)},203:function(a){admin.messages.error(a.msg)}}})},cancel_form:function(){this.active=!1,admin.panels.close_all(),admin.menu.see(),$("#wa_toolbar_menu li").removeClass("selected"),$("#wa_toolbar_menu li.preview").addClass("selected")},cancel_edit_form:function(){this.active=!1,admin.panels.close_all(),$(".wa_placeholder_widget").is(":visible")?($("#wa_toolbar_menu li").removeClass("selected"),$("#wa_toolbar_menu li.content").addClass("selected")):($("#wa_toolbar_menu li").removeClass("selected"),$("#wa_toolbar_menu li.preview").addClass("selected"))},refresh_header:function(a){a==undefined?admin.GET({url:"/wa/website/header/",statusCode:{200:function(a){$("#header").html(a.html),admin.edit.refresh()}}}):($("#header").html(a),admin.edit.refresh())},refresh_navigation:function(a){a!=undefined&&($("#nav").html(a),admin.edit.refresh())},refresh_content:function(a){a!=undefined&&($("#main-content").html(a),admin.edit.refresh())},refresh_footer:function(a){a==undefined?admin.GET({url:"/wa/website/footer/",statusCode:{200:function(a){$("#footer").html(a.html),admin.edit.refresh()}}}):($("#footer").html(a),admin.edit.refresh())},refresh_layout:function(a,b){b?$("#layout-"+a).html(b):admin.GET({url:"/wa/page/layout/",data:{layout_section_slug:a},statusCode:{200:function(b){$("#layout-"+a).html(b.html),admin.edit.refresh()}}})},refresh_placeholder:function(a,b){a&&b&&$("#"+a).html(b)},refresh_default:function(a,b){var c=$("#default-placeholder");for(item in a)c.append(a[item]);for(item in b)$("#"+b[item]).remove()},refresh_layout_and_default_with_html:function(a,b,c,d){admin.pages.refresh_default(c,d),admin.pages.refresh_layout(a,b),admin.edit.refresh()}},admin.panels={panel:["bottom","bottom_large","center","left","right","full","menu","right_colomn","left_colomn","file_manager"],animation:{bottom:"slide",bottom_large:"slide",center:"fade",left:"fade",right:"fade",full:"fade",menu:"slide",right_colomn:"fade",left_colomn:"slide",file_manager:"fade"},display:function(a,b,c){admin.panels.close_others(a),admin.loading.hide();var d=$("#wa_panel_"+a);d.is(":visible")?d.find(".content").html(b):(admin.menu.close_sub_menu(),d.find(".content").html(b),d.show(admin.panels.animation[a]),$("#wa_bg_panels").show()),admin.messages.refresh_help_text_bubble()},change_content:function(a,b,c){$("#wa_panel_"+a).find(".content").html(b),admin.messages.refresh_help_text_bubble()},close:function(a,b){var c=$("#wa_panel_"+a);c.hide(admin.panels.animation[a],function(){c.find(".content").html(""),b&&b()}),$("#wa_bg_panels").hide()},close_others:function(a){admin.pages.active=!1;for(var b=0;b<admin.panels.panel.length;b++)admin.panels.panel[b]!=a&&$("#wa_panel_"+admin.panels.panel[b]).is(":visible")&&admin.panels.close(admin.panels.panel[b])},close_all:function(){for(var a=0;a<admin.panels.panel.length;a++)$("#wa_panel_"+admin.panels.panel[a]).is(":visible")&&admin.panels.close(admin.panels.panel[a])}},admin.plugins={placeholder:null,list:function(a){admin.urls.hash("/plugins/add/!/"+a),admin.plugins.placeholder=a,admin.GET({url:"/wa/plugins/",statusCode:{200:function(a){admin.panels.display("full",a.html)}}})},list_by_category:function(a){admin.GET({url:"/wa/plugins/category/"+a+"/",statusCode:{200:function(a){$("#plugins_categorieslist").html(a.html)}}}),$("#plugins_categories li").removeClass("selected"),$("#plugins_categories ."+a).addClass("selected"),$("#plugins_description").html("")},description:function(a){admin.GET({url:"/wa/plugins/description/"+a+"/",statusCode:{200:function(a){$("#plugins_description").html(a.html)}}}),$("#plugins_categorieslist li").removeClass("selected"),$("#plugins_categorieslist .plugin_"+a).addClass("selected")},add:function(a){admin.GET({url:"/wa/plugin/",data:{placeholder_id:admin.plugins.placeholder,plugin_type:a}})},create:function(){list=admin.serialize("#plugin_form_form"),admin.PUT({url:"/wa/plugin/",data:list,statusCode:{200:function(a){admin.messages.alert(a.msg),admin.panels.close_all(),$("head").append(a.medias),admin.pages.refresh_layout(a.layout_section_slug,a.html),admin.edit.refresh()}}})},remove:function(a){admin.messages.confirm(gettext("Are you sure you want to delete this plugin ?"),function(){admin.DELETE({url:"/wa/plugin/"+a+"/",data:{"plugin-id":a},statusCode:{200:function(b){admin.messages.alert(b.msg),$("#"+a).hide("slow",function(){$("#"+a).remove()})}}})})},edit:function(a){admin.urls.hash("/plugins/edit/!/"+a),admin.GET({url:"/wa/plugin/"+a+"/"})},save:function(){list=admin.serialize("#plugin_form_form"),id=$("#plugin_form_form input[name=id]").attr("value"),admin.POST({url:"/wa/plugin/"+id+"/",data:list,statusCode:{200:function(a){admin.messages.alert(a.msg),admin.panels.close_all(),admin.pages.refresh_layout(a.layout_section_slug,a.html),admin.edit.refresh()}}})}},admin.settings={more:function(){admin.GET({url:"/wa/website/versions/",statusCode:{200:function(a){admin.urls.hash("/versions"),admin.panels.display("right_colomn",a.html)}}})},analytics:{get:function(){admin.GET({url:"/wa/website/analytics/",statusCode:{200:function(a){admin.urls.hash("/analytics"),admin.panels.display("center",a.html)}}})},post:function(){list=admin.serialize("#page_analytics_form"),admin.POST({url:"/wa/website/analytics/",data:list,statusCode:{200:function(a){admin.panels.close("center")},400:function(a){admin.messages.error(a.msg)}}})}},domains:{list:function(){admin.GET({url:"/wa/website/domains/",statusCode:{200:function(a){admin.urls.hash("/domains"),admin.panels.display("center",a.html)}}})},add:function(){admin.GET({url:"/wa/website/domain/",statusCode:{200:function(a){admin.urls.hash("/domains/add"),admin.panels.display("center",a.html)}}})},edit_form:function(a){admin.GET({url:"/wa/website/domain/"+a+"/",statusCode:{200:function(a){admin.panels.display("center",a.html)}}})},create:function(){list=admin.serialize("#domain_form"),admin.PUT({url:"/wa/website/domain/",data:list,statusCode:{200:function(a){admin.messages.alert(a.msg),admin.settings.domains.list()}}})},edit:function(a){list=admin.serialize("#domain_form"),admin.POST({url:"/wa/website/domain/"+a+"/",data:list,statusCode:{200:function(a){admin.messages.alert(a.msg),admin.settings.domains.list()}}})},set_primary:function(a){admin.POST({url:"/wa/website/domain/"+a+"/",data:{primary:""}})},remove:function(a){admin.messages.confirm(gettext("Deleting the domain :<br /><br />Are you sure that you want to delete this domain name now?"),function(){admin.DELETE({url:"/wa/website/domain/"+a+"/",statusCode:{200:function(a){a.msg&&(admin.messages.alert(a.msg),admin.settings.domains.list())}}})})},cancel_form:function(){admin.settings.domains.list()}},referencement:{get:function(){admin.GET({url:"/wa/website/referencement/",statusCode:{200:function(a){admin.urls.hash("/seo"),admin.panels.display("center",a.html)}}})},post:function(){list=admin.serialize("#page_referencement_form"),admin.POST({url:"/wa/website/referencement/",data:list,statusCode:{200:function(a){admin.panels.close("center")},400:function(a){admin.messages.error(a.msg)}}})}},maintenance:{get:function(){admin.GET({url:"/wa/website/maintenance/",statusCode:{200:function(a){admin.panels.display("center",a.html)}}})},post:function(){list=admin.serialize("#page_maintenance_form"),admin.POST({url:"/wa/website/maintenance/",data:list})}},currentUser:{get:function(){admin.GET({url:"/wa/users/currentUser/",statusCode:{200:function(a){admin.urls.hash("/user"),admin.panels.display("center",a.html)}}})},post:function(){list=admin.serialize("#user_pass_form"),admin.POST({url:"/wa/users/currentUser/",data:list,statusCode:{200:function(a){admin.panels.close("center")},400:function(a){json=admin.xhr2json(a),admin.panels.change_content("center",json.html)}}})}},cancel_form:function(){$("#wa_toolbar_menu li").removeClass("selected"),$("#wa_toolbar_menu li.preview").addClass("selected"),admin.cancel_form()}},admin.urls={hash:function(a){if(a===undefined)return window.location.hash;window.location.hash=a,$.cookie("ionyweb_admin",a)},load:function(a){argv=a.split("/!/")[1],a=a.split("/!/")[0];switch(a){case"":admin.menu.see();break;case"/analytics":admin.settings.analytics.get();break;case"/content":admin.edit.active(),$("#wa_toolbar_menu li").removeClass("selected"),$("#wa_toolbar_menu li.content").addClass("selected");break;case"/domains":admin.settings.domains.list();break;case"/domains/add":admin.settings.domains.add();break;case"/file_manager":admin.file_manager.toggle();break;case"/page_manager":admin.pages.list();break;case"/pages/edit":admin.pages.edit_form(argv);break;case"/plugins/add":admin.plugins.list(argv);break;case"/plugins/edit":admin.plugins.edit(argv);break;case"/seo":admin.settings.referencement.get();break;case"/user":admin.settings.currentUser.get();break;case"/themes":admin.design.list();break;case"/themes/styles":admin.design.styles(argv);break;case"/versions":admin.settings.more();break;default:admin.menu.see()}}},$(document).ready(function(){val=$.cookie("ionyweb_admin"),val&&($.cookie("ionyweb_admin",null),admin.urls.hash(val),admin.urls.load(val))}),admin.themes={list:function(){$.ajax({type:"GET",url:window.location.pathname+"wa/themes/",statusCode:{200:function(a){admin.panels.display("bottom",a.html)}}})},edit:function(a,b){$("#themes_listform").parent().hide("slow",function(){$("#themes_listform").parent().html("")}),a!="0"&&$.ajax({type:"POST",url:"/wa/themes/",data:{page_path:window.location.pathname,theme_slug:a,csrfmiddlewaretoken:b},statusCode:{200:function(a){admin.messages.alert(a.msg),setTimeout(function(){window.location.reload(),admin.panels.close_all()},1e3)}}})}},admin.file_manager={current_directory:0,selector_activate:!1,tinymce_activate:!1,input_id:null,toggle:function(){$("#wa_file_manager").is(":visible")?(admin.panels.close("full"),$("#wa_toolbar_menu li").removeClass("selected"),$("#wa_toolbar_menu li.preview").addClass("selected"),admin.urls.hash("")):admin.GET({url:"/wa/file_manager/",statusCode:{200:function(a){admin.urls.hash("/file_manager"),admin.panels.display("full",a.html),admin.file_manager.refresh_draggable_sortable_file()}}})},selector:{open:function(a){admin.file_manager.input_id=a,admin.GET({url:"/wa/file_manager/",data:{selector:!0},statusCode:{200:function(a){$("#wa_panel_file_manager_selector .content").html(a.html),$("#wa_panel_file_manager_selector").show("fade"),admin.file_manager.selector_activate=!0}}})},close:function(){$("#wa_panel_file_manager_selector").hide("fade",function(){$("#wa_panel_file_manager_selector .content").html("")}),admin.file_manager.selector_activate=!1,admin.file_manager.tinymce_activate=!1},send:function(a){admin.file_manager.tinymce_activate?tinyMCE.activeEditor.execCommand("mceInsertContent",!1,"<img src='"+a+"' alt='' />"):$("#"+admin.file_manager.input_id).val(a),admin.file_manager.selector.close()}},tinymce:{open:function(a){admin.file_manager.tinymce_activate=!0,admin.file_manager.selector.open(a)}},upload:{get:function(){admin.GET({url:"/wa/file_manager/upload/",statusCode:{200:function(a){admin.file_manager.toggle_right_colomn(a.html)}}})}},directory:{get:function(a){a===undefined&&(admin.file_manager.current_directory?a=admin.file_manager.current_directory:a=0),admin.GET({url:"/wa/file_manager/dir/"+a+"/",statusCode:{200:function(b){admin.file_manager.refresh_file_list(b.html),admin.file_manager.current_directory=a,admin.file_manager.directory.refresh_selected()}}})},put:function(a){a===undefined&&(admin.file_manager.current_directory?a=admin.file_manager.current_directory:a=0),admin.PUT({url:"/wa/file_manager/dir/"+a+"/",statusCode:{200:function(a){admin.file_manager.refresh_file_list(a.files_list),admin.file_manager.refresh_directory_list(a.directory_list),admin.file_manager.directory.rename(a.id),admin.file_manager.directory.refresh_selected()}}})},remove:function(a){admin.DELETE({url:"/wa/file_manager/dir/"+a+"/",statusCode:{200:function(b){admin.file_manager.refresh_directory_list(b.directory_list),admin.file_manager.directory.refresh_selected(),$("#wa_file_manager .quota").html(b.quota),$("#dir-"+a).hide(function(){$(this).remove()})}}})},rename:function(a){tmp_onClick_over=$("#dir-"+a+" a:first-child").attr("onClick"),$("#dir-"+a+" a:first-child").removeAttr("onClick");var b=$("#dir-"+a+" .name .label_js"),c=b.html();b.html("<form><input type='text' name='dir-label' /></form>");var d=$("#dir-"+a+" .name .label_js form input");d.val(c);var e=$("#dir-"+a+" .name .label_js form");$("#dir-"+a+" .name .label_js form").submit(function(){b.unbind("focusout"),admin.POST({url:"/wa/file_manager/dir/"+a+"/",data:{name:d.val()},statusCode:{200:function(c){b.html(d.val()),$("#dir-"+a+" a:first-child").attr("onClick",tmp_onClick_over),admin.file_manager.refresh_file_list(c.files_list),admin.file_manager.refresh_directory_list(c.directory_list)}}});return!1}),d.focusout(function(){b.html(c),$("#dir-"+a+" a:first-child").attr("onClick",tmp_onClick_over)}),d.focus()},refresh_selected:function(){$("#wa_file_manager_list .directory_list .selected").removeClass("selected"),$("#wa_file_manager_list .directory_list #directory-"+admin.file_manager.current_directory).addClass("selected")}},file:{get:function(a){$("#"+a).hasClass("selected")?($("#"+a).removeClass("selected"),admin.file_manager.toggle_right_colomn()):($("#"+a).parent().children(".selected").removeClass("selected"),$("#"+a).addClass("selected"),admin.GET({url:"/wa/file_manager/file/"+a+"/",data:{selector:admin.file_manager.selector_activate},statusCode:{200:function(a){admin.file_manager.toggle_right_colomn(a.html),admin.lightbox.init()}}}))},remove:function(a){admin.DELETE({url:"/wa/file_manager/file/"+a+"/",statusCode:{200:function(b){admin.file_manager.toggle_right_colomn(),$("#wa_file_manager .quota").html(b.quota),$("#"+a).hide(function(){$(this).remove()})}}})},get_thumbnail:function(a,b){admin.GET({url:"/wa/file_manager/thumbnail/",data:{path:a,size:b},statusCode:{200:function(a){admin.file_manager.selector.send(a.thumbnail)}}})},rename:function(a){tmp_onClick_over=$("#"+a+" a:first-child").attr("onClick"),$("#"+a+" a:first-child").removeAttr("onClick");var b=$("#"+a+" .name .label_js"),c=b.html();b.html("<form><input type='text' name='label' /></form>");var d=$("#"+a+" .name .label_js form input");d.val(c);var e=$("#"+a+" .name .label_js form");$("#"+a+" .name .label_js form").submit(function(){b.unbind("focusout"),admin.POST({url:"/wa/file_manager/file/"+a+"/",data:{name:d.val()},statusCode:{200:function(c){b.html(d.val()),$("#"+a+" a:first-child").attr("onClick",tmp_onClick_over),admin.file_manager.refresh_file_list(c.files_list)}}});return!1}),d.focusout(function(){b.html(c),$("#"+a+" a:first-child").attr("onClick",tmp_onClick_over)}),d.focus()}},toggle_quota:function(){$("#wa_file_manager .quota").height()<50?($("#wa_file_manager .quota").animate({height:"300px"}),$("#wa_file_manager .list_directory").animate({bottom:"300px"})):($("#wa_file_manager .quota").animate({height:"30px"}),$("#wa_file_manager .list_directory").animate({bottom:"30px"}))},refresh_file_list:function(a){$("#wa_file_manager_content .file_list").html(a),admin.file_manager.refresh_draggable_sortable_file()},refresh_directory_list:function(a){$("#wa_file_manager_list .directory_list").html(a),admin.file_manager.refresh_draggable_sortable_file()},refresh_draggable_sortable_file:function(){var a="";$(".draggable").draggable({revert:"invalid",zIndex:2700,opacity:.6,distance:10,start:function(b,c){a=c.helper.children("a").attr("onClick"),c.helper.children("a").removeAttr("onClick")},drag:function(b,c){a=c.helper.children("a").attr("onClick"),c.helper.children("a").removeAttr("onClick")},stop:function(b,c){c.helper.children("a").attr("onClick",a)}}),$(".droppable").droppable({accept:".draggable",over:function(a,b){tmp_onClick_over=$(this).children("a").attr("onClick"),$(this).children("a").removeAttr("onClick")},out:function(a,b){$(this).children("a").attr("onClick",tmp_onClick_over)},drop:function(a,b){$(this).children("a").attr("onClick",tmp_onClick_over),admin.POST({url:"/wa/file_manager/",data:{drop:b.draggable.attr("id"),"in":$(this).attr("id"),current:admin.file_manager.current_directory},statusCode:{200:function(a){b.draggable.remove(),$("#wa_file_manager_list .directory_list").html(a.directory_list)}}})}})},toggle_right_colomn:function(a){a==undefined?$("#wa_file_manager_right").is(":visible")&&($("#wa_file_manager_right").animate({width:"0px"},function(){$("#wa_file_manager_right").hide().html("")}),$("#wa_file_manager_content").animate({right:"0px"})):$("#wa_file_manager_right").is(":visible")?$("#wa_file_manager_right").html(a):($("#wa_file_manager_right").html(a).show(),$("#wa_file_manager_right").animate({width:"300px"}),$("#wa_file_manager_content").animate({right:"300px"}))},display_mode:function(a){admin.POST({url:"/wa/file_manager/display/"
,data:{mode:a},statusCode:{200:function(a){admin.file_manager.directory.get()},404:function(a){}}})}}